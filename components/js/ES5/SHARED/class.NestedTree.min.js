if("undefined"==typeof OGX)var OGX=function(){};OGX.prototype.NestedTree=function(e){function t(e){return e.hasOwnProperty("originalEvent")?e.originalEvent.changedTouches[0]:e}function r(){var e,t,r,n;if(I={y:0,after:null,over:null},u.find(".ogx_nested_tree_item:visible").each(function(t,s){if(!$(s).hasClass("ogx_nested_tree_item_drag")){if(r=$(s).find(".ogx_nested_tree_item_head:first"),n=r.find(".ogx_nested_tree_item_arrow:first"),e=$(s).position().top+r.height(),Math.abs(G-(e-r.height()/2))<M.midThres)return I.over=$(s),I.after=!1,n.hasClass("ogx_nested_tree_item_arrow_closed")&&g($(s)),!0;e<G&&e>I.y&&(I.y=e,I.after=$(s))}}),(I.over||I.after)&&u.find(".ogx_nested_tree_item_head_select").removeClass("ogx_nested_tree_item_head_select"),I.over)s(!1),$(I.over).find(".ogx_nested_tree_item_head:first").addClass("ogx_nested_tree_item_head_select");else if(I.after){L?_(I.after.find(".ogx_nested_tree_item_head:first")):s(!0,I.after),t=L.width();var d=I.after.data("path").split("_");L.find(".ogx_nested_tree_bar_line:first").css("width",t-M.padding*(d.length-2)+"px")}}function s(e,t){if(e){var r='<div class="ogx_nested_tree_bar"><span class="ogx_nested_tree_bar_line"></span></div>';t.after(r),L=u.find(".ogx_nested_tree_bar:first")}else u.find(".ogx_nested_tree_bar:first").remove(),L=!1}function _(e){var t=u.find(".ogx_nested_tree_bar:first").detach();e.after(t[0]),L=u.find(".ogx_nested_tree_bar:first")}function n(){if((I.over||I.after)&&(T=u.find(".ogx_nested_tree_item_drag:first").detach(),T.removeClass("ogx_nested_tree_item_drag"),T.css("position","static"),T.css("width","auto"),T.css("left",""),T.css("top",""),s(!1)),I.over){u.find(".ogx_nested_tree_item_head_select").removeClass("ogx_nested_tree_item_head_select");var e=o(I.over.find(".ogx_nested_tree_item_grip:first").css("margin-left")),t=I.over.find(".ogx_nested_tree_item_head:first"),r=I.over.find(".ogx_nested_tree_item_body:first"),_=t.find(".ogx_nested_tree_item_noarrow:first");_.length>0&&_.removeClass("ogx_nested_tree_item_noarrow").addClass("ogx_nested_tree_item_arrow");var n=I.over.find(".ogx_nested_tree_item_arrow:first");T.find(".ogx_nested_tree_item_grip:first").css("margin-left",e+M.padding+"px"),r.append(T[0]),n.removeClass("ogx_nested_tree_item_arrow_opened"),n.addClass("ogx_nested_tree_item_arrow_closed"),r.addClass("ogx_nested_tree_body_hidden");i(T.data("path"),I.over.data("path"));I.over.find(".ogx_nested_tree_item_arrow:first").hasClass("ogx_nested_tree_item_arrow_opened")||g(I.over)}else if(I.after){var r=I.after.parent(0),a=I.after.data("path").split("_");a.pop();a.length-1;a=a.join("_");i(T.data("path"),a,I.after.index());T.data("path").slice(0,-2)===a&&r.children(".ogx_nested_tree_item").length===I.after.index()+1?r.append(T[0]):r.find(".ogx_nested_tree_item:eq("+I.after.index()+")").after(T[0])}T.addClass("ogx_nested_tree_item"),d(),I.over=null,I.after=null,T=null,u.trigger(OGX.NestedTree.DRAG_END)}function d(){function e(t,r){var s,_,n,d,i=0;t.children(".ogx_nested_tree_item").each(function(t,o){$(o).hasClass("ogx_nested_tree_item_drag")||($(o).attr("data-path",r+"_"+i),_=r+"_"+i,_=_.split("_"),_=_.length-2,$(o).find(".ogx_nested_tree_item_grip:first").css("margin-left",M.padding*_),s=$(o).find(".ogx_nested_tree_item_body:first"),n=$(o).find(".ogx_nested_tree_item_head:first"),d=n.find(".ogx_nested_tree_item_arrow:first"),s.children(".ogx_nested_tree_item").length>0?(d.removeClass("ogx_nested_tree_item_arrow_none"),d.addClass("ogx_nested_tree_item_arrow_closed"),e(s,r+"_"+i)):(d.addClass("ogx_nested_tree_item_arrow_none"),d.removeClass("ogx_nested_tree_item_arrow_opened"),d.removeClass("ogx_nested_tree_item_arrow_closed")),i++)})}e(u,"0")}function i(e,t,r){if("undefined"==typeof r)var r=!1;var s=p(e),_=e.split("_"),n=_.pop();_=_.join("_");var d=p(_),i=p(t);return d&&i?(i.hasOwnProperty("items")||(i.items=[]),r?i.items.splice(r+1,0,s):i.items.push(s),d.items.splice(n,1),i):void console.log("bug: obj not found!")}function o(e){var t=e.split("px");return parseInt(t[0])}function a(e){e?$("body").on(X,function(e){e=t(e);var s=T.height();T.css("top",e.pageY-s+D.el.parent(0).scrollTop()+"px"),G=e.pageY-s+u.parent(0).scrollTop(),r()}):$("body").off(X)}function f(e,t){function r(){if(y){var e=(new Date).getTime();if(e-w>=M.dragAfter&&!A){A=!0,u.trigger(OGX.NestedTree.DRAG_START);var t=b.position().left,r=b.width(),s=b.height();T=b.detach(),T.removeClass("ogx_nested_tree_item"),T.addClass("ogx_nested_tree_item_drag"),T.css("left",t+1+"px"),T.css("top",S.y-s+"px"),T.css("width",r+"px"),u.prepend(T),a(!0),d()}}}e?(b=t,C={path:t.data("path").split("_"),body:t.parent(0)},C.path.pop(),A=!1,y=!0,w=(new Date).getTime(),O=setInterval(r,20)):(y=!1,clearInterval(O),O=null,a(!1))}function l(e){e?(u.on(E,".ogx_nested_tree_item_arrow",function(e){g($(this).parent(0).parent(0))}),u.on(E,".ogx_nested_tree_item_grip",function(e){e=t(e),S={x:e.pageX,y:e.pageY+u.parent(0).scrollTop()},f(!0,$(this).parent(0).parent(0)),$("body").on(N,function(e){e=t(e),f(!1),A?(A=!1,n()):(b=null,C=null),$("body").off(N)})})):(u.off(E,".ogx_nested_tree_item_arrow"),$("body").off(N))}function g(e){var t=e.find(".ogx_nested_tree_item_body:first"),r=p(e.data("path"));if(t.children().length>0){var s=e.find(".ogx_nested_tree_item_arrow:first");t.hasClass("ogx_nested_tree_body_hidden")?(s.removeClass("ogx_nested_tree_item_arrow_closed"),s.addClass("ogx_nested_tree_item_arrow_opened"),t.removeClass("ogx_nested_tree_body_hidden"),r.opened=!0,u.trigger(OGX.NestedTree.OPEN,r)):(s.removeClass("ogx_nested_tree_item_arrow_opened"),s.addClass("ogx_nested_tree_item_arrow_closed"),t.addClass("ogx_nested_tree_body_hidden"),r.opened=!1,u.trigger(OGX.NestedTree.CLOSE,r))}else{delete r.opened;var _=OGX.NestedTree.SELECT;e.data("event")&&(_=e.data("event")),u.trigger(_,r)}}function p(e){var t=e.split("_"),r=M.data,s=t.slice();for(s.shift();s.length>0;)r.hasOwnProperty("items")&&(r=r.items[s[0]]),s.shift();return r}function m(){c(M.data,u,0,"0")}function c(e,t,r,s){t.empty();var _,n,d,i,o,a,f,l,g="";if(e.hasOwnProperty("items")&&e.items){o=r*M.padding;for(var p=0;p<e.items.length;p++)i=" ogx_nested_tree_body_hidden",a="ogx_nested_tree_item_noarrow",f=!1,l=s+"_"+p,g="",e.items[p].hasOwnProperty("opened")&&e.items[p].opened?(i="",f=!0):e.items[p].opened=!1,h(e.items[p])&&(n=!1,e.items[p].hasOwnProperty("items")&&e.items[p].items.length>0?(n=!0,a="ogx_nested_tree_item_arrow",a+=f?" ogx_nested_tree_item_arrow_opened":" ogx_nested_tree_item_arrow_closed"):delete e.items[p].opened,_='<div class="ogx_nested_tree_item" data-path="'+l+'"><div class="ogx_nested_tree_item_head">',_+=M.edit?'<span class="ogx_nested_tree_item_grip" style="margin-left:'+o+'px;"></span><span class="ogx_nested_tree_item_label">':'<span class="ogx_nested_tree_item_label" style="margin-left:'+o+'px;">',_+=e.items[p].label+'</span><span class="'+a+'"></span></div><div class="ogx_nested_tree_item_body'+i+'"></div></div>',t.append(_),d=t.find(".ogx_nested_tree_item:last").find(".ogx_nested_tree_item_body:first"),n&&c(e.items[p],d,r+1,l))}}function h(e){if(e.hasOwnProperty("scopes"))for(var t=0;t<e.scopes.length;t++)if(M.scopes.indexOf(e.scopes[t])!==-1)return!0;return!1}function x(){for(var e in P)M.hasOwnProperty(e)||(M[e]=P[e]);var t=M.data.slice();switch(M.data={items:t},D.el=u=$(M.container),u.addClass("ogx_nested_tree"),M.mode){case OGX.NestedTree.MODE_MOBILE:E="touchstart",N="touchend",X="touchmove";break;case OGX.NestedTree.MODE_DESKTOP:E="mousedown",N="mouseup",X="mousemove"}M.edit||(E="click")}function v(){x(),m(),l(!0)}var u,w,O,y,T,b,C,G,E,N,X,D=this,P={scopes:["public"],padding:20,edit:!0,dragAfter:1e3,openOnDrag:!0,midThres:7,mode:OGX.NestedTree.MODE_MOBILE},M=e,S={x:0,y:0},A=!1,L=!1,I={};this.el=null,this.setScopes=function(e){M.scopes=e},this.getData=function(){return M.data},this.destroy=function(){l(!1)},v()},OGX.NestedTree=function(e){return new OGX.prototype.NestedTree(e)},OGX.NestedTree.SELECT="select",OGX.NestedTree.OPEN="open",OGX.NestedTree.CLOSE="close",OGX.NestedTree.DRAG_START="dragStart",OGX.NestedTree.DRAG_END="dragEnd",OGX.NestedTree.MODE_MOBILE="modeMobile",OGX.NestedTree.MODE_DESKTOP="modeDesktop";